
http://thebuild.com/presentations/not-your-job-pgconf-us-2017.pdf

Do not backup to mounted network (NFS,
etc.) shares.

http://momjian.us/main/writings/pgsql/hw_performance
NFS and other remote file systems are not recommended for use by POSTGRESQL. NFS does not have the same file system semantics as a local file system, and these inconsistencies can cause data reliability or crash recovery problems.


https://www.slideshare.net/JonathanBattiato/postgresql-on-nfs-jbattiato-pgday2016?qid=5f509856-e519-4866-9e3f-7a49f543b7aa&v=&b=&from_search=1

https://www.slideshare.net/GiuseppeBroccolo/gbroccolo-pgconfeu2016-pgnfs?qid=f5b46507-62c6-40b6-a9fc-2adadfbc34cc&v=&b=&from_search=2

Running PostgresDocker
====================

Ashiss-MBP:blockmonitoring Ashis$ docker search "postgres"
NAME                      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
postgres                  The PostgreSQL object-relational database ...   3649      [OK]       
kiasaki/alpine-postgres   PostgreSQL docker image based on Alpine Linux   31                   [OK]
abevoelker/postgres       Postgres 9.3 + WAL-E + PL/V8 and PL/Python...   10                   [OK]
macadmins/postgres        Postgres that accepts remote connections b...   8                    [OK]
jamesbrink/postgres       Highly configurable PostgreSQL container.       5                    [OK]
eeacms/postgres           Docker image for PostgreSQL (RelStorage re...   4                    [OK]


step 1- start postgres as an instance
=====
$docker run --name pg-9.6 -e POSTGRES_PASSWORD=test123 -d postgres

Ashiss-MBP:blockmonitoring Ashis$ docker run --name pg-9.6 -e POSTGRES_PASSWORD=test123 -d postgres
2a94df2c0160d962405196cc878ea70b099941437f9d2236bc121e0ba752d23c
Ashiss-MBP:blockmonitoring Ashis$ docker ps -a
CONTAINER ID        IMAGE                                               COMMAND                  CREATED             STATUS                   PORTS               NAMES
2a94df2c0160        postgres                                            "docker-entrypoint..."   10 seconds ago      Up 6 seconds             5432/tcp            pg-9.6

step 2- Run Postgres as as server
=========

$docker run -it --rm --link pg-9.6:postgres postgres psql -h postgres -U postgres

Ashiss-MBP:blockmonitoring Ashis$ docker run -it --rm --link pg-9.6:postgres postgres psql -h postgres -U postgres
Password for user postgres: ]

psql (9.6.3)
Type "help" for help.

Alternate option - docker exec -it pg-9.6 psql -U postgres 

Step 3 - entering into bash 
==========
docker exec -it pg-9.6 /bin/bash
root@2a94df2c0160:/var/lib/postgresql/data# su postgres
#login as postgres
$ export
export GOSU_VERSION='1.7'
export HOME='/home/postgres'
export HOSTNAME='2a94df2c0160'
export LANG='en_US.utf8'
export LOGNAME='postgres'
export MAIL='/var/mail/postgres'
export OLDPWD='/var/lib/postgresql/data/pg_xlog'
export PATH='/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games'
export PGDATA='/var/lib/postgresql/data'
export PG_MAJOR='9.6'
export PG_VERSION='9.6.3-1.pgdg80+1'
export POSTGRES_PASSWORD='test123'
export PWD='/var/lib/postgresql/data'
export SHELL='/bin/sh'
export SHLVL='1'
export TERM='xterm'
export USER='postgres'
export _='pwd'
export no_proxy='*.local, 169.254/16'

step 4- if container is stopped and To start the existing docker containers
=========
$docker start pg-9.6

pg_ctl in 

root@2a94df2c0160:/var/lib/postgresql/data# which pg_ctl
/usr/lib/postgresql/9.6/bin/pg_ctl

 ==========
 
 Backup and Restore-
 ==================
 
 https://www.mkyong.com/database/postgresql-point-in-time-recovery-incremental-backup/
 
 https://github.com/PacktPublishing/PostgreSQL-9.6-High-Performance
 
 https://github.com/2ndQuadrant/ext4-data-loss
 
 
 http://www.cybertec.at/postgresql-tablespaces-its-not-so-scary/
 
 http://blog.cloud66.com/hot-backups-for-postgresql/?utm_content=bufferb2c0d&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer
 http://phili.pe/posts/postgresql-on-the-command-line/#building-a-query
 
 Roles====
 
 http://phili.pe/posts/postgresql-on-the-command-line/#building-a-query

 
 Role
 ====
https://tech.instacart.com/bootstrapping-postgres-users-cd594e5f28e9

pgPool
======

https://blog.dbi-services.com/vertically-scale-your-postgresql-infrastructure-with-pgpool-1-basic-setup-and-watchdog-configuration/

https://www.slideshare.net/AshnikBiz/architecture-for-building-scalable-and-highly-available-postgres-cluster
https://www.enterprisedb.com/postgres-plus-edb-blog/jason-davis/pgpool-ii-enables-horizontal-scalability-postgres
https://www.enterprisedb.com/blog/little-respect-pgpool-ii

pgbech test--
https://www.slideshare.net/EnterpriseDB/pgpool-load-testing

https://sonnguyen.ws/replication-load-balance-in-posgresql-replication-with-pgpool2/

http://evol-monkey.blogspot.com/2013/12/scaling-postgres-with-pgpool-ii.html
https://webcms.enterprisedb.com/docs/en/9.4/instguide/Postgres_Plus_Advanced_Server_Installation_Guide.1.48.html
https://www.slideshare.net/EnterpriseDB/pgpool-load-testing
http://www.cybertec.at/connection-pooling-intro-pgbouncer-and-pgpool-ii/
http://www.cnblogs.com/geosky/p/pgpool-loadbalance-FAQ.html
https://sonnguyen.ws/replication-load-balance-in-posgresql-replication-with-pgpool2/

https://hackernoon.com/postgresql-cluster-into-kubernetes-cluster-f353cde212de
http://www.edbguides.com/pgpool/pgpool-quickstart
https://www.itenlight.com/blog/2016/05/25/PostgreSQL+HA+with+pgpool-II+-+Part+6

pgPool-watchdog
=================

http://www.pgpool.net/pgpool-web/contrib_docs/watchdog/en.html
https://blog.dbi-services.com/vertically-scale-your-postgresql-infrastructure-with-pgpool-1-basic-setup-and-watchdog-configuration/
http://jensd.be/591/linux/setup-a-redundant-postgresql-database-with-repmgr-and-pgpool
http://www.edbguides.com/efm/efm-2-1-quickstart

Connection pool
https://dzone.com/articles/scaling-connections-in-postgres
http://lets.postgresql.jp/documents/technical/pgpool-II-3.3-watchdog/1
http://lets.postgresql.jp/documents/technical/pgpool-II-3.3-watchdog/1#multi-master

Postgres Internals
========

https://fritshoogland.wordpress.com/2017/07/01/postgresql-block-internals/
https://jetruby.com/expertise/mobile-app-development-postgresql-database/?utm_content=buffer816ba&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer
https://speakerdeck.com/matrixise/python-and-postgresql-a-wonderful-wedding-english
https://speakerdeck.com/matrixise/python-and-postgresql-a-wonderful-wedding-english

postgresql interesting troubleshooting-

https://www.manniwood.com/postgresql_stuff/index.html
log_min_duration 


pgbouncer
==========
https://gist.github.com/afair/380389

https://gpdb.docs.pivotal.io/4390/admin_guide/access_db/topics/pgbouncer.html
https://www.ashnik.com/installation-steps-for-pgbouncer-on-powerlinux/
https://opensourcedbms.com/dbms/setup-pgbouncer-connection-pooling-for-postgresql-on-centosredhatfedora/
https://prezi.com/hudqfcujchnm/intro-to-pgbouncer/
http://pgconf.in/#price
http://heyiyi.blog.51cto.com/205455/1884440
https://blog.twitch.tv/how-twitch-uses-postgresql-c34aa9e56f58
https://pgbouncer.github.io/usage.html
https://pgconf.ru/en/2017
http://technobytz.com/install-configure-pgbouncer-pooling-in-postgresql-1.html
http://penningpence.blogspot.com/2016/03/multi-layered-connection-pooling-with.html
http://blog.postgresql-consulting.com/2015/06/3-reasons-to-use-pgbouncer.html
https://www.depesz.com/2012/12/02/what-is-the-point-of-bouncing/
http://blog.endpoint.com/2015/09/pgbouncer-user-and-database-poolmode.html
http://peter.eisentraut.org/blog/2015/03/25/retrieving-pgbouncer-statistics-via-dblink/
http://blog.endpoint.com/2015/05/connected-to-pgbouncer-or-postgres.html?utm_content=buffer23af7&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer
https://dba.stackexchange.com/questions/56559/postgresql-high-availability-scalability-using-haproxy-and-pgbouncer?utm_source=twitterfeed&utm_medium=twitter
http://pgpen.blogspot.sg/2013/10/installation-steps-for-pgbouncer-on.html

Pg troubleshotting
====================

https://www.openscg.com/2016/11/is-my-query-stuck-postgresql-9-6/?utm_source=dlvr.it&utm_medium=twitter

xDB-
=====
MMR setup in
https://community.postgresrocks.net/t5/Postgres-Gems/Replication-Server-6-Quickstart-Multi-Master-Replication/ba-p/126
http://www.edbguides.com/replication-server/replication-server-6-quickstart-mmr

Monitoring -
==========
https://d4mations.com/monitoring-postgresql-kevin-kempter/
Logs - look out for FATAL, HINT, LOG (Tool -pgbadger)

OS Monitoring -
ps,top, iostat, vmstat
top - what is the overall workload
iostat - check for I/O issue...
iostat device status - %user, %iowait(welath of information ) - flooding of i/o- focus on debugging issue, if i/o chaneel is flooded, pointe is
increase in memory, buffer.. ,%idle, 

Network tools-
Netstat
netstat -an |grep LISTEN
netstat -an |grep LISTEN |grep tcp
netstat -an |grep LISTEN|grep PGSQL

Postgres Statistcs Collector-
pg_stat_archiver - just one row..monitor this table to understand the file usage
pg_stat_bgwriter - 
pg_stat_database - one row, no of conflicts...,
hit ratio <90% , some performance tuning to do 
pg_stat_all_table - similar to RTS
pg_stat_user_table - when vacumm was run and auto vaccum etc
pg_stat_replication
pg_stat_

Top runnning query

SELECT
  pid,
  now() — pg_stat_activity.query_start AS duration,
  query,
  state
FROM pg_stat_activity
WHERE now() — pg_stat_activity.query_start > interval '5 minutes';

In order to cancel these long running queries you should execute:

SELECT pg_cancel_backend(__pid__);
note=never use pg_terminate_backend as it's equivalent of doing kill -9 command

Table hit ratio

Database hit ratio

Performance TIps
==========
Fine Tune postgresql parms - good for testing
https://www.myintervals.com/blog/2014/12/16/five-simple-postgresql-optimizations-for-improving-performance/?utm_content=57486773&utm_medium=social&utm_source=twitter
https://github.com/kmoppel?tab=repositories
https://github.com/cybertec-postgresql/postgres-showcase
python-postgres
=============
https://github.com/WisChang005/PostgreSQL/blob/master/utils/pgsql_connection.py
https://github.com/Caullyn/Python_scripts_PostgreSQL/tree/master/db_script
https://github.com/Jaymon/dump
https://github.com/micromachine/postgres-backup/blob/master/dbpgbackup.py
https://github.com/pmaluf/pgzabbix
https://github.com/akmans/backupdb/blob/master/bin/pg2gz.py
https://github.com/davenquinn/psql_backup
https://github.com/commandprompt/pg_maint
https://github.com/phsiao/pglog-summary/blob/master/pglog-summary.py

https://github.com/JohnArchieMckown/PostgreSQL-DBA-tools
https://github.com/smbennett1974/PostgreSQL
https://github.com/pgexperts/pgx_scripts

